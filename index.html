<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Urban Renew - Community Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html, body { height: 100%; margin: 0; font-family: "Segoe UI", Arial, sans-serif; background: #f5f5f5; }
    #map { height: 100%; width: 100%; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    #locateBtn {
      position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      z-index: 1000; background: #4285f4; color: white; border: none;
      padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: 600;
    }
    #locateBtn:hover { background: #3367d6; }
  </style>
</head>
<body>
  <button id="locateBtn">üìç Find My Location</button>
  <div id="map"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // üî• Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBuQI813zZeJj4RSlU2_fsBb20lWTCqa7o",
  authDomain: "urban-renew-map.firebaseapp.com",
  databaseURL: "https://urban-renew-map-default-rtdb.asia-southeast1.firebasedatabase.app/", // üîπ Add this line
  projectId: "urban-renew-map",
  storageBucket: "urban-renew-map.appspot.com",
  messagingSenderId: "138295290989",
  appId: "1:138295290989:web:3ae9ce333ebc4a1a6aa364",
  measurementId: "G-6GXK4MHR0Q"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Initialize map
    const map = L.map('map').setView([22.9734, 78.6569], 5);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB', subdomains: 'abcd', maxZoom: 19
    }).addTo(map);

    const markerMap = {};

    // Load existing pins from Firebase
    db.ref("pins").on("value", snapshot => {
      const pins = snapshot.val() || {};
      // Remove old markers
      Object.values(markerMap).forEach(marker => map.removeLayer(marker));
      Object.keys(markerMap).forEach(key => delete markerMap[key]);

      Object.keys(pins).forEach(id => {
        const { lat, lng, name } = pins[id];
        const marker = L.marker([lat, lng]).addTo(map);

        marker.on("click", () => {
          const newName = prompt("Edit pin name:", name);
          if (newName === null) return; // Cancelled
          if (newName === "") {
            // Delete if empty
            db.ref("pins/" + id).remove();
            map.removeLayer(marker);
          } else {
            db.ref("pins/" + id).update({ name: newName });
          }
        });

        markerMap[id] = marker;
      });
    });

    // Add new pin via map click
    map.on('click', e => {
      const lat = e.latlng.lat;
      const lng = e.latlng.lng;
      const name = prompt("Enter pin name:", "Unnamed Pin");
      if (name !== null && name !== "") {
        db.ref("pins").push({ lat, lng, name });
      }
    });

    // Locate user
    document.getElementById("locateBtn").onclick = () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;
          map.setView([latitude, longitude], 15);
          L.marker([latitude, longitude]).addTo(map).bindPopup("üìç You are here!").openPopup();
        }, () => { alert("Unable to get your location"); });
      } else { alert("Geolocation not supported"); }
    };
  </script>
</body>
</html>

